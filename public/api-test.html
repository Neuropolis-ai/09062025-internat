<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—Ü–µ–π API - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .api-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .endpoint {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #e1e8ed;
            border-radius: 5px;
        }
        .method {
            padding: 5px 10px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            min-width: 60px;
            text-align: center;
        }
        .get { background-color: #28a745; }
        .post { background-color: #007bff; }
        .put { background-color: #ffc107; color: #000; }
        .delete { background-color: #dc3545; }
        .url {
            flex: 1;
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 3px;
            margin-right: 10px;
        }
        .test-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
        .test-btn:hover {
            background-color: #138496;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .auth-section {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .token-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-family: monospace;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè´ –õ–∏—Ü–µ–π-–∏–Ω—Ç–µ—Ä–Ω–∞—Ç "–ü–æ–¥–º–æ—Å–∫–æ–≤–Ω—ã–π"</h1>
        <h2>Backend API - –ü–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <p>–°–µ—Ä–≤–µ—Ä: <span id="server-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span></p>
        <a href="/" style="color: white; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π</a>
    </div>

    <div class="stats" id="stats">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <div class="auth-section">
        <h3>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
        <p>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints –≤–≤–µ–¥–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω:</p>
        <input type="text" id="jwt-token" class="token-input" placeholder="Bearer —Ç–æ–∫–µ–Ω (–ø–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ /api/v1/auth/login)">
        <div style="margin-top: 10px;">
            <button onclick="loginAsAdmin()" class="test-btn">–í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω</button>
            <button onclick="loginAsStudent()" class="test-btn">–í–æ–π—Ç–∏ –∫–∞–∫ –°—Ç—É–¥–µ–Ω—Ç</button>
        </div>
    </div>

    <div class="api-section">
        <h3>üìä –°–∏—Å—Ç–µ–º–Ω—ã–µ endpoints</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/health</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/health')">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-health" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/users</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/users')">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-users" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üõí L-shop (–¢–æ–≤–∞—Ä—ã)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/products</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/products')">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-products" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üèõÔ∏è –ê—É–∫—Ü–∏–æ–Ω—ã (–∑–∞—â–∏—â–µ–Ω–æ JWT)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/auctions</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/auctions', true)">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-auctions" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üìÑ –ì–æ—Å–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–∑–∞—â–∏—â–µ–Ω–æ JWT)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/contracts</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/contracts', true)">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-contracts" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üí¨ –ù–µ–π—Ä–æ—á–∞—Ç (–∑–∞—â–∏—â–µ–Ω–æ JWT)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/chat/status</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/chat/status', true)">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-chat" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üìÅ –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–∑–∞—â–∏—â–µ–Ω–æ JWT)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/storage/status</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/storage/status', true)">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-storage" class="result" style="display: none;"></div>
    </div>

    <div class="api-section">
        <h3>üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∑–∞—â–∏—â–µ–Ω–æ JWT)</h3>
        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="url">/api/v1/email/status</span>
            <button class="test-btn" onclick="testEndpoint('GET', '/api/v1/email/status', true)">–¢–µ—Å—Ç</button>
        </div>
        <div id="result-email" class="result" style="display: none;"></div>
    </div>

    <script>
        let currentToken = '';

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkServerStatus();
            loadStats();
        };

        async function checkServerStatus() {
            try {
                const response = await fetch('/api/v1/health');
                const data = await response.json();
                document.getElementById('server-status').innerHTML = 
                    `<span style="color: #28a745;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (uptime: ${Math.floor(data.uptime)}s)</span>`;
            } catch (error) {
                document.getElementById('server-status').innerHTML = 
                    `<span style="color: #dc3545;">‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>`;
            }
        }

        async function loadStats() {
            try {
                const [usersRes, productsRes] = await Promise.all([
                    fetch('/api/v1/users'),
                    fetch('/api/v1/products')
                ]);
                
                const users = await usersRes.json();
                const products = await productsRes.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${users.length}</div>
                        <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${products.length}</div>
                        <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">8+</div>
                        <div class="stat-label">API –ú–æ–¥—É–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">70+</div>
                        <div class="stat-label">Endpoints</div>
                    </div>
                `;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        async function loginAsAdmin() {
            try {
                const response = await fetch('/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@lyceum.ru',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                if (data.accessToken) {
                    currentToken = data.accessToken;
                    document.getElementById('jwt-token').value = currentToken;
                    alert('‚úÖ –£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –∫–∞–∫ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }
        }

        async function loginAsStudent() {
            try {
                const response = await fetch('/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'student@lyceum.ru',
                        password: 'student123'
                    })
                });
                
                const data = await response.json();
                if (data.accessToken) {
                    currentToken = data.accessToken;
                    document.getElementById('jwt-token').value = currentToken;
                    alert('‚úÖ –£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –∫–∞–∫ –°—Ç—É–¥–µ–Ω—Ç!');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }
        }

        async function testEndpoint(method, endpoint, requiresAuth = false) {
            const resultId = 'result-' + endpoint.split('/').pop();
            const resultDiv = document.getElementById(resultId);
            
            try {
                const headers = {
                    'Content-Type': 'application/json',
                };
                
                if (requiresAuth) {
                    const token = document.getElementById('jwt-token').value || currentToken;
                    if (!token) {
                        throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ endpoint');
                    }
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(endpoint, {
                    method: method,
                    headers: headers
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch {
                    parsedData = data;
                }
                
                resultDiv.className = response.ok ? 'result success' : 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                    <strong>Response:</strong><br>
                    <pre>${JSON.stringify(parsedData, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <strong>–û—à–∏–±–∫–∞:</strong> ${error.message}
                `;
            }
        }
    </script>
</body>
</html> 